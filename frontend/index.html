<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LangExtract Studio ‚Äî AI-Powered Text Extraction</title>
  <meta name="description"
    content="LangExtract Studio: Visually extract structured entities from any text using LLMs. Define prompts, add few-shot examples, and visualize results instantly." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="styles.css?v=170889" />
</head>

<body>

  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <div class="logo-mark">
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="28" height="28" rx="8" fill="url(#logoGrad)" />
          <path d="M7 9h14M7 14h10M7 19h6" stroke="white" stroke-width="2" stroke-linecap="round" />
          <circle cx="21" cy="19" r="3" fill="white" opacity="0.9" />
          <defs>
            <linearGradient id="logoGrad" x1="0" y1="0" x2="28" y2="28" gradientUnits="userSpaceOnUse">
              <stop stop-color="#6366f1" />
              <stop offset="1" stop-color="#8b5cf6" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div>
        <h1 class="app-title">LangExtract <span class="title-studio">Studio</span></h1>
        <span class="app-subtitle">AI-Powered Structured Extraction</span>
      </div>
    </div>
    <div class="header-right">
      <!-- Mode Toggle -->
      <div class="mode-toggle" id="modeToggle">
        <button class="mode-btn active" id="modeStandard" data-mode="standard">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="16 18 22 12 16 6" />
            <polyline points="8 6 2 12 8 18" />
          </svg>
          Standard
        </button>
        <button class="mode-btn" id="modeClinical" data-mode="clinical">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
          </svg>
          Clinical
        </button>
        <button class="mode-btn" id="modeStructured" data-mode="structured">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <line x1="3" y1="9" x2="21" y2="9" />
            <line x1="9" y1="21" x2="9" y2="9" />
          </svg>
          Schema
        </button>
      </div>
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span class="status-text">Ready</span>
      </div>
      <a href="https://github.com/google/langextract" target="_blank" rel="noopener noreferrer" class="github-link"
        title="View on GitHub">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 2C6.48 2 2 6.48 2 12c0 4.42 2.87 8.17 6.84 9.49.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.6-3.37-1.34-3.37-1.34-.45-1.15-1.11-1.46-1.11-1.46-.91-.62.07-.61.07-.61 1 .07 1.53 1.03 1.53 1.03.89 1.52 2.34 1.08 2.91.83.09-.64.35-1.08.63-1.33-2.22-.25-4.55-1.11-4.55-4.94 0-1.09.39-1.98 1.03-2.68-.1-.25-.45-1.27.1-2.64 0 0 .84-.27 2.75 1.02.8-.22 1.65-.33 2.5-.33s1.7.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.37.2 2.39.1 2.64.64.7 1.03 1.59 1.03 2.68 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85 0 1.34-.01 2.41-.01 2.74 0 .27.18.58.69.48A10.02 10.02 0 0 0 22 12c0-5.52-4.48-10-10-10z" />
        </svg>
      </a>
    </div>

  </header>

  <!-- Main App -->
  <main class="app-main" id="appMain">

    <!-- LEFT PANEL: Config -->
    <aside class="panel panel-config" id="configPanel">
      <div class="panel-header">
        <div class="panel-header-icon config-icon">‚öôÔ∏è</div>
        <h2 class="panel-title">Configuration</h2>
        <button class="panel-collapse-btn" id="collapseConfig" title="Collapse panel">‚Äπ</button>
      </div>
      <div class="panel-body">


        <!-- ‚îÄ‚îÄ Provider + API Key ‚îÄ‚îÄ -->
        <section class="config-section">
          <h3 class="section-label">
            <span class="section-icon">üîë</span> Provider &amp; API Key
          </h3>

          <!-- Provider tabs -->
          <div class="provider-tabs" id="providerTabs">
            <button class="provider-tab active" data-provider="gemini">
              <span class="provider-logo">‚ú¶</span> Gemini
            </button>
            <button class="provider-tab" data-provider="openai">
              <span class="provider-logo">‚äï</span> OpenAI
            </button>
            <button class="provider-tab" data-provider="claude">
              <span class="provider-logo">‚óá</span> Claude
            </button>
            <button class="provider-tab" data-provider="glm">
              <span class="provider-logo">‚äó</span> GLM
            </button>
          </div>

          <!-- Per-provider key inputs (only active one is shown) -->
          <div class="provider-key-panels">
            <div class="provider-key-panel" id="keyPanel-gemini">
              <div class="input-wrapper secret">
                <input type="password" id="apiKey-gemini" class="form-input" placeholder="AIza‚Ä¶ (Gemini API key)"
                  autocomplete="off" />
                <button class="input-toggle-btn" data-toggle="apiKey-gemini" title="Show/hide">
                  <svg class="eye-open" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                  <svg class="eye-closed u-hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                    <line x1="1" y1="1" x2="23" y2="23" />
                  </svg>
                </button>
              </div>
              <p class="input-hint">Get a free key at <a href="https://aistudio.google.com/app/apikey" target="_blank"
                  rel="noopener" class="link">aistudio.google.com</a></p>
            </div>
            <div class="provider-key-panel u-hidden" id="keyPanel-openai">
              <div class="input-wrapper secret">
                <input type="password" id="apiKey-openai" class="form-input" placeholder="sk-‚Ä¶ (OpenAI API key)"
                  autocomplete="off" />
                <button class="input-toggle-btn" data-toggle="apiKey-openai" title="Show/hide">
                  <svg class="eye-open" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                  <svg class="eye-closed u-hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                    <line x1="1" y1="1" x2="23" y2="23" />
                  </svg>
                </button>
              </div>
              <p class="input-hint">Get a key at <a href="https://platform.openai.com/api-keys" target="_blank"
                  rel="noopener" class="link">platform.openai.com</a></p>
            </div>
            <div class="provider-key-panel u-hidden" id="keyPanel-claude">
              <div class="input-wrapper secret">
                <input type="password" id="apiKey-claude" class="form-input" placeholder="sk-ant-‚Ä¶ (Anthropic key)"
                  autocomplete="off" />
                <button class="input-toggle-btn" data-toggle="apiKey-claude" title="Show/hide">
                  <svg class="eye-open" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                  <svg class="eye-closed u-hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                    <line x1="1" y1="1" x2="23" y2="23" />
                  </svg>
                </button>
              </div>
              <p class="input-hint">Get a key at <a href="https://console.anthropic.com/settings/keys" target="_blank"
                  rel="noopener" class="link">console.anthropic.com</a></p>
            </div>
            <div class="provider-key-panel u-hidden" id="keyPanel-glm">
              <div class="input-wrapper secret">
                <input type="password" id="apiKey-glm" class="form-input" placeholder="ZhipuAI API key"
                  autocomplete="off" />
                <button class="input-toggle-btn" data-toggle="apiKey-glm" title="Show/hide">
                  <svg class="eye-open" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                  <svg class="eye-closed u-hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                    <line x1="1" y1="1" x2="23" y2="23" />
                  </svg>
                </button>
              </div>
              <p class="input-hint">Get a key at <a href="https://open.bigmodel.cn/usercenter/apikeys" target="_blank"
                  rel="noopener" class="link">open.bigmodel.cn</a></p>
            </div>
          </div>
        </section>

        <!-- ‚îÄ‚îÄ Model Selection ‚îÄ‚îÄ -->
        <section class="config-section">
          <h3 class="section-label">
            <span class="section-icon">ü§ñ</span> Model
          </h3>
          <select id="modelSelect" class="form-input u-pointer">
            <optgroup label="Gemini" id="modelGroup-gemini">
              <option value="gemini-2.5-flash">Gemini 2.5 Flash (Recommended)</option>
              <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
              <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
              <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
            </optgroup>
            <optgroup label="OpenAI" id="modelGroup-openai" class="u-hidden">
              <option value="gpt-4o">GPT-4o</option>
              <option value="gpt-4o-mini">GPT-4o mini</option>
              <option value="gpt-4-turbo">GPT-4 Turbo</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
            </optgroup>
            <optgroup label="Claude" id="modelGroup-claude" class="u-hidden">
              <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
              <option value="claude-3-opus-20240229">Claude 3 Opus</option>
              <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
            </optgroup>
            <optgroup label="GLM (ZhipuAI)" id="modelGroup-glm" class="u-hidden">
              <option value="glm-4">GLM-4</option>
              <option value="glm-4-flash">GLM-4 Flash</option>
              <option value="glm-4-air">GLM-4 Air</option>
              <option value="glm-4-plus">GLM-4 Plus</option>
            </optgroup>
          </select>
          <p class="input-hint u-mt-sm" id="modelHint">gemini-2.5-flash</p>
        </section>


        <!-- Prompt Description -->
        <section class="config-section">
          <div class="u-flex-between">
            <h3 class="section-label u-m-0">
              <span class="section-icon">üìù</span> Prompt Description
            </h3>
            <button id="openPromptLibraryBtn" class="btn-secondary btn-sm u-p-sm">
              üìö Library
            </button>
          </div>
          <div class="prompt-templates-row u-mt-md">
            <button class="template-chip active" data-template="literary">Literary</button>
            <button class="template-chip" data-template="medical">Medical</button>
            <button class="template-chip" data-template="news">News</button>
            <button class="template-chip" data-template="custom">Custom</button>
          </div>
          <textarea id="promptDescription" class="form-textarea" rows="5" placeholder="Describe what to extract‚Ä¶">Extract characters, emotions, and relationships in order of appearance.
Use exact text for extractions. Do not paraphrase or overlap entities.
Provide meaningful attributes for each entity to add context.</textarea>
        </section>

      </div>
    </aside>

    <!-- CENTER PANEL: Input + Examples -->
    <section class="panel panel-input">
      <div class="panel-header">
        <div class="panel-header-icon input-icon">‚úçÔ∏è</div>
        <h2 class="panel-title">Input &amp; Examples</h2>
      </div>
      <div class="panel-body">

        <!-- Input Text -->
        <div class="input-section">
          <div class="section-row">
            <h3 class="section-label"><span class="section-icon">üìÑ</span> Text to Analyze</h3>
            <div class="char-counter">
              <span id="charCount">0</span> chars
              <span class="est-cost u-text-dim u-ml-auto">
                (~<span id="tokenCount">0</span> tokens | <span id="estCost">$0.000</span>)
              </span>
            </div>
          </div>
          <textarea id="inputText" class="form-textarea code-font" rows="7"
            placeholder="Paste or type the text you want to analyze‚Ä¶">Lady Juliet gazed longingly at the stars, her heart aching for Romeo, whose absence filled her with a deep and melancholic yearning.</textarea>
        </div>

        <!-- Divider -->
        <div class="section-divider">
          <span>Few-Shot Examples <span class="badge-count" id="examplesCount">1</span></span>
        </div>

        <!-- Examples Container -->
        <div id="examplesContainer" class="examples-container">
          <!-- Example cards injected by JS -->
        </div>

        <button class="btn-secondary add-example-btn" id="addExampleBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
          Add Example
        </button>

        <!-- Extract Button -->
        <div class="extract-footer">
          <button class="btn-extract" id="extractBtn">
            <span class="extract-btn-content">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3" />
              </svg>
              Run Extraction
            </span>
            <span class="extract-spinner u-hidden" id="extractSpinner">
              <span class="spinner"></span>
              Extracting‚Ä¶
            </span>
          </button>
          <p class="extract-hint">Uses <span id="modelHint">gemini-2.5-flash</span> ¬∑ Results appear on the right</p>
        </div>

      </div>
    </section>

    <!-- RIGHT PANEL: Results -->
    <section class="panel panel-results" id="resultsPanel">
      <div class="panel-header">
        <div class="panel-header-icon results-icon">‚ú®</div>
        <h2 class="panel-title">Results</h2>
        <div class="results-tabs u-hidden" id="resultsTabs">
          <button class="results-tab active" data-tab="viz" id="tabViz">Visualization</button>
          <button class="results-tab" data-tab="json" id="tabJson">JSON</button>
        </div>
      </div>
      <div class="panel-body results-body">

        <!-- Empty State -->
        <div class="empty-state" id="emptyState">
          <div class="empty-illustration">
            <svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="10" y="14" width="52" height="44" rx="6" fill="#1e1e2e" stroke="#3b3b55" stroke-width="2" />
              <rect x="18" y="22" width="28" height="3" rx="1.5" fill="#6366f1" opacity="0.6" />
              <rect x="18" y="30" width="36" height="2" rx="1" fill="#4b4b6b" />
              <rect x="18" y="36" width="30" height="2" rx="1" fill="#4b4b6b" />
              <rect x="18" y="42" width="22" height="2" rx="1" fill="#4b4b6b" />
              <circle cx="54" cy="50" r="11" fill="url(#emptyGrad)" opacity="0.9" />
              <path d="M50 50l2.5 2.5L57 47" stroke="white" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" />
              <defs>
                <linearGradient id="emptyGrad" x1="43" y1="39" x2="65" y2="61" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#6366f1" />
                  <stop offset="1" stop-color="#8b5cf6" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h3 class="empty-title">No extractions yet</h3>
          <p class="empty-desc">Configure your prompt and examples, then click <strong>Run Extraction</strong> to see
            structured results appear here.</p>
        </div>

        <!-- Error State -->
        <div class="error-state u-hidden" id="errorState">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h3 class="error-title">Extraction failed</h3>
          <p class="error-msg" id="errorMsg">An unknown error occurred.</p>
          <button class="btn-secondary mt-2"
            onclick="document.getElementById('errorState').style.display='none'; document.getElementById('emptyState').style.display='flex';">Dismiss</button>
        </div>

        <!-- Visualization Tab -->
        <div id="tabVizContent" class="tab-content u-hidden">
          <iframe id="vizFrame" class="viz-frame" title="Extraction Visualization"
            sandbox="allow-scripts allow-same-origin"></iframe>
        </div>

        <!-- JSON Tab -->
        <div id="tabJsonContent" class="tab-content u-hidden">
          <div class="json-toolbar">
            <span class="json-label">Raw Extraction Result</span>
            <button class="btn-copy" id="copyJsonBtn" title="Copy JSON">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
              Copy
            </button>
          </div>
          <pre id="jsonOutput" class="json-output"></pre>
        </div>

      </div>
    </section>

  </main>

  <!-- ============================================
       CLINICAL MODE ‚Äî Full-width overlay panel
       ============================================ -->
  <main class="clinical-main u-hidden" id="clinicalMain">

    <!-- Clinical Config (collapsible left) -->
    <aside class="panel panel-config" id="clinicalConfigPanel">
      <div class="panel-header">
        <div class="panel-header-icon config-icon">‚öôÔ∏è</div>
        <h2 class="panel-title">Configuration</h2>
      </div>
      <div class="panel-body">

        <!-- Live Provider Badge -->
        <section class="config-section">
          <h3 class="section-label"><span class="section-icon">ü§ñ</span> Active Provider</h3>
          <div class="provider-active-badge" id="clinProviderBadge">
            <span class="pab-icon" id="clinProviderIcon">G</span>
            <div class="pab-info">
              <div class="pab-name" id="clinProviderName">Gemini</div>
              <div class="pab-model" id="clinProviderModel">gemini-2.5-flash</div>
            </div>
            <button class="pab-change" id="clinChangeProviderBtn" title="Change provider">‚öôÔ∏é</button>
          </div>
        </section>

        <!-- Clinical Note Stats -->
        <section class="config-section">
          <h3 class="section-label"><span class="section-icon">üìä</span> Note Stats</h3>
          <div class="note-stats-grid">
            <div class="note-stat"><span id="clinWordCount">0</span><small>words</small></div>
            <div class="note-stat"><span id="clinLineCount">0</span><small>lines</small></div>
            <div class="note-stat"><span id="clinCharCount">0</span><small>chars</small></div>
            <div class="note-stat u-text-secondary"><span id="clinTokenCount">0</span><small>tokens
                (<span id="clinCostEst">$0.0000</span>)</small></div>
          </div>
        </section>

        <!-- File Upload hint -->
        <section class="config-section">
          <div class="info-box">
            <div class="info-box-icon">üìÅ</div>
            <div>
              <div class="info-box-title">File Upload</div>
              <p class="info-box-desc">Drop PDF, DOCX, or TXT onto the note area to import text directly.</p>
            </div>
          </div>
        </section>

        <!-- History shortcut -->
        <section class="config-section">
          <h3 class="section-label"><span class="section-icon">üïê</span> Recent Extractions</h3>
          <button class="btn-secondary u-w-full" id="openHistoryBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="1 4 1 10 7 10" />
              <path d="M3.51 15a9 9 0 1 0 .49-3.74" />
            </svg>
            View History
          </button>
        </section>

      </div>
    </aside>

    <section class="panel panel-clinical-input">
      <div class="panel-header">
        <div class="panel-header-icon">üè•</div>
        <h2 class="panel-title">Raw EMR Note</h2>
        <div class="char-counter u-ml-auto"><span id="clinCharCount">0</span> chars</div>
      </div>
      <div class="panel-body clinical-input-body">
        <!-- File drop zone -->
        <div id="clinFileDropZone" class="file-drop-zone">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="17 8 12 3 7 8" />
            <line x1="12" y1="3" x2="12" y2="15" />
          </svg>
          <span>Drop PDF, DOCX, or TXT here</span>
          <label class="file-select-btn">
            Browse
            <input type="file" id="clinFileInput" accept=".txt,.pdf,.docx" hidden />
          </label>
          <span id="clinFileName" class="file-name-tag"></span>
        </div>
        <textarea id="clinicalNoteText" class="form-textarea code-font clinical-note-textarea"
          placeholder="Paste the raw EMR note here, or drop a file above‚Ä¶
The AI will strip administrative clutter and return a structured clinical JSON with HPI, PMH, vitals, labs, imaging, plan, and more."></textarea>
        <div class="extract-footer">
          <button class="btn-extract" id="clinicalExtractBtn">
            <span class="extract-btn-content" id="clinExtractContent">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
              </svg>
              Clean &amp; Extract
            </span>
            <span class="extract-spinner u-hidden" id="clinExtractSpinner">
              <span class="spinner"></span>
              Processing note‚Ä¶
            </span>
          </button>
          <p class="extract-hint">‚åò+Enter to run ¬∑ Uses <span id="clinModelHint">gemini-2.5-flash</span></p>
        </div>
      </div>
    </section>

    <!-- Clinical Results -->
    <section class="panel panel-results" id="clinicalResultsPanel">
      <div class="panel-header">
        <div class="panel-header-icon results-icon">‚ú®</div>
        <h2 class="panel-title">Structured Clinical Data</h2>
        <div class="results-tabs u-hidden" id="clinResultsTabs">
          <button class="results-tab active" data-clin-tab="cards" id="clinTabCards">Cards</button>
          <button class="results-tab" data-clin-tab="json" id="clinTabJson">JSON</button>
          <button class="btn-copy u-ml-auto u-p-sm u-fs-sm u-flex-center u-border-thin u-bg-dark-glass"
            id="clinCopyHistoriesBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>
            Copy Histories
          </button>
        </div>
      </div>
      <div class="panel-body results-body">
        <div id="clinSmartSummary" class="smart-summary u-hidden"></div>
        <div class="empty-state" id="clinEmptyState">
          <div class="empty-illustration">
            <svg width="72" height="72" viewBox="0 0 72 72" fill="none">
              <rect x="10" y="8" width="52" height="56" rx="6" fill="#1e1e2e" stroke="#3b3b55" stroke-width="2" />
              <path d="M22 22h12M22 30h28M22 38h24M22 46h18" stroke="#6366f1" stroke-width="2" stroke-linecap="round"
                opacity="0.7" />
              <circle cx="52" cy="54" r="11" fill="url(#clinGrad)" />
              <path d="M48 54l2.5 2.5L56 49" stroke="white" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" />
              <defs>
                <linearGradient id="clinGrad" x1="41" y1="43" x2="63" y2="65" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#14b8a6" />
                  <stop offset="1" stop-color="#6366f1" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h3 class="empty-title">No note processed yet</h3>
          <p class="empty-desc">Paste a raw EMR note and click <strong>Clean &amp; Extract</strong> to see structured
            clinical data.</p>
        </div>
        <div class="error-state u-hidden" id="clinErrorState">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h3 class="error-title">Extraction failed</h3>
          <p class="error-msg" id="clinErrorMsg">An unknown error occurred.</p>
        </div>
        <!-- Cards view -->
        <div id="clinTabCardsContent" class="tab-content clin-cards-content u-hidden"></div>
        <!-- JSON view -->
        <div id="clinTabJsonContent" class="tab-content u-hidden">
          <div class="json-toolbar">
            <span class="json-label">Structured JSON Output</span>
            <button class="btn-copy" id="clinCopyJsonBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
              Copy
            </button>
          </div>
          <pre id="clinJsonOutput" class="json-output"></pre>
        </div>
      </div>
    </section>

  </main><!-- /clinical-main -->

  <!-- STRUCTURED SCHEMA MAIN -->
  <main class="app-main structured-main u-hidden" id="structuredMain">

    <!-- LEFT PANEL: Schema Builder -->
    <aside class="panel panel-config" id="structConfigPanel">
      <div class="panel-header">
        <div class="panel-header-icon config-icon">üìã</div>
        <h2 class="panel-title">Schema Builder</h2>
      </div>
      <div class="panel-body">

        <section class="config-section">
          <h3 class="section-label"><span class="section-icon">ü§ñ</span> Active Provider</h3>
          <div class="provider-active-badge" id="structProviderBadge">
            <span class="pab-icon" id="structProviderIcon">G</span>
            <div class="pab-info">
              <div class="pab-name" id="structProviderName">Gemini</div>
              <div class="pab-model" id="structProviderModel">gemini-2.5-flash</div>
            </div>
            <button class="pab-change" id="structChangeProviderBtn" title="Change provider">‚öôÔ∏é</button>
          </div>
          <p class="u-fs-xs u-text-muted u-mt-md">Provider &amp; key set in Standard mode
            config.</p>
        </section>

        <!-- Divider -->
        <div class="section-divider">
          <span>Schema Fields <span class="badge-count" id="structFieldCount">0</span></span>
        </div>

        <div id="structFieldsContainer" class="examples-container">
          <!-- Dynamically injected fields go here -->
        </div>

        <button class="btn-secondary add-example-btn" id="structAddFieldBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
          Add Field
        </button>

      </div>
    </aside>

    <!-- CENTER PANEL: Input -->
    <section class="panel panel-input u-flex-col">
      <div class="panel-header u-flex-between">
        <div class="u-flex-center">
          <div class="panel-header-icon input-icon">‚úçÔ∏è</div>
          <h2 class="panel-title">Document Input</h2>
        </div>
        <div class="mode-toggle u-m-0 u-p-sm">
          <button class="mode-btn active" id="structInputModeSingleBtn" class="u-p-md u-fs-sm-alt">Single</button>
          <button class="mode-btn" id="structInputModeBatchBtn" class="u-p-md u-fs-sm-alt">Batch
            ‚ö°Ô∏è</button>
        </div>
      </div>
      <div class="panel-body u-flex-1 u-flex-col">

        <!-- Single Input View -->
        <div id="structSingleInputView" class="u-flex-col u-flex-1">
          <div class="input-section u-flex-1">
            <textarea id="structInputText" class="form-textarea code-font u-h-full u-min-h-300"
              placeholder="Paste document text here to extract data matching your schema..."></textarea>
          </div>
          <div class="struct-input-stats">
            <span id="structWordCount">0</span> words ¬∑ <span id="structCharCount">0</span> chars
            <span class="est-cost u-text-dim u-ml-auto">
              ¬∑ ~<span id="structTokenCount">0</span> tokens (<span id="structCostEst">$0.0000</span>)
            </span>
          </div>
        </div>

        <!-- Batch Input View -->
        <div id="structBatchInputView" class="u-hidden u-flex-col u-flex-1">
          <div class="file-drop-zone u-mb-md" id="structBatchDropZone">
            <div class="file-drop-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
            </div>
            <h3>Drag & Drop files here</h3>
            <p>Supports .txt, .pdf, .docx, .md</p>
            <input type="file" id="structBatchFileInput" multiple accept=".txt,.pdf,.docx,.md" class="u-hidden"
              title="Batch file upload">
            <button class="btn-secondary btn-sm u-mt-md"
              onclick="document.getElementById('structBatchFileInput').click()">Browse Files</button>
          </div>

          <div class="batch-list-container u-flex-1 u-hidden u-bg-surface-light u-radius-md"
            id="structBatchListContainer">
            <table class="schema-table u-m-0 u-w-full">
              <thead class="u-sticky-top u-bg-primary">
                <tr>
                  <th class="u-p-md u-text-left u-fs-xs u-border-bottom">
                    File Name</th>
                  <th class="u-p-md u-text-right u-fs-xs u-border-bottom">
                    Size</th>
                  <th class="u-p-md u-border-bottom"></th>
                </tr>
              </thead>
              <tbody id="structBatchFileList">
                <!-- files injected here -->
              </tbody>
            </table>
          </div>
          <div class="struct-input-stats u-hidden u-flex-between u-mt-md" id="structBatchStats">
            <span><span id="structBatchCount">0</span> files queued</span>
            <button class="btn-secondary btn-sm u-p-sm u-fs-xs" id="structBatchClearBtn">Clear All</button>
          </div>
        </div>

        <div class="extract-footer u-mt-lg">
          <button class="btn-extract" id="structExtractBtn">
            <span class="extract-btn-content" id="structExtractBtnContent">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3" />
              </svg>
              Extract Structured JSON
            </span>
            <span class="extract-spinner u-hidden" id="structExtractSpinner">
              <span class="spinner"></span> Working‚Ä¶
            </span>
          </button>
          <p class="extract-hint">Uses <span id="structProviderHint">gemini ¬∑ gemini-2.5-flash</span></p>
        </div>
      </div>
    </section>

    <!-- RIGHT PANEL: Results -->
    <section class="panel panel-results">
      <div class="panel-header">
        <div class="panel-header-icon results-icon">‚ú®</div>
        <h2 class="panel-title">Extracted JSON</h2>
        <div class="u-ml-auto u-flex u-gap-md u-flex-center">
          <button class="btn-copy u-hidden" id="structCsvBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            CSV
          </button>
          <button class="btn-copy u-hidden" id="structCopyJsonBtn">Copy</button>
        </div>
      </div>
      <div class="panel-body results-body u-bg-dark u-radius-md">
        <div class="empty-state" id="structEmptyState">
          <div class="empty-illustration">
            <span class="u-fs-xl">üìä</span>
          </div>
          <h3 class="empty-title">Waiting for Extraction</h3>
          <p class="empty-desc">Define your schema fields, paste text, and click Extract.</p>
        </div>
        <pre id="structJsonOutput" class="json-output u-hidden u-h-full u-border-none"></pre>
      </div>
    </section>

  </main><!-- /structured-main -->

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>


  <!-- ‚îÄ‚îÄ History Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="historyModal" class="modal-overlay">
    <div class="modal-panel">
      <div class="modal-header">
        <h2>&#x1F550; Extraction History</h2>
        <div class="modal-header-actions">
          <button class="btn-secondary btn-sm" id="clearHistoryBtn">Clear All</button>
          <button class="btn-icon" id="closeHistoryBtn" title="Close">&times;</button>
        </div>
      </div>
      <div id="historyList" class="history-list">
        <p class="history-empty">No extractions saved yet.</p>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Prompt Library Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="promptModal" class="modal-overlay">
    <div class="modal-panel u-max-w-600">
      <div class="modal-header">
        <h2>üìö Prompt Library</h2>
        <div class="modal-header-actions">
          <button class="btn-icon" id="closePromptBtn" title="Close">&times;</button>
        </div>
      </div>

      <div class="modal-body u-p-xl">
        <div class="u-flex u-gap-md u-mb-md">
          <input type="text" id="newPromptName" class="form-input u-flex-1" placeholder="Save current prompt as...">
          <button id="savePromptBtn" class="btn-primary u-p-md">Save</button>
        </div>

        <div id="promptList" class="history-list u-max-h-400 u-p-0 u-bg-transparent">
          <p class="history-empty">No saved prompts.</p>
        </div>
      </div>

      <div class="modal-footer u-p-lg u-border-top u-flex u-gap-md">
        <button id="exportPromptsBtn" class="btn-secondary btn-sm">Export JSON</button>
        <button id="importPromptsBtn" class="btn-secondary btn-sm">Import JSON</button>
        <input type="file" id="importPromptsFile" class="u-hidden" accept=".json" title="Import prompts from JSON">
      </div>
    </div>
  </div>

  <script type="module" src="app.js?v=951012"></script>
</body>

</html>